# =============================================================================
# Blockchain & IPFS Configuration
# =============================================================================
# Copy this file to blockchain.yml and configure for your environment
# cp blockchain.yml.example blockchain.yml

# =============================================================================
# HYPERLEDGER FABRIC CONFIGURATION
# =============================================================================

fabric:
  # Network connection profile (JSON file path)
  # This file defines peers, orderers, channels, and organizations
  # Generate this from your Fabric network deployment
  network_profile: "/path/to/fabric-network.json"

  # Channel names
  channels:
    hot_chain: "hot-chain"      # Active investigations
    cold_chain: "cold-chain"    # Archived investigations

  # Chaincode (smart contract) names
  chaincodes:
    evidence: "evidence-chaincode"
    custody: "custody-chaincode"

  # mTLS Configuration (JumpServer as Fabric client)
  # These certificates are issued BY Fabric CA TO JumpServer
  mtls:
    # Client certificate (issued by Fabric CA)
    cert_file: "/etc/jumpserver/certs/fabric/client.pem"

    # Client private key
    key_file: "/etc/jumpserver/certs/fabric/client-key.pem"

    # Fabric CA root certificate (to verify Fabric network)
    ca_cert_file: "/etc/jumpserver/certs/fabric/ca.pem"

  # Admin credentials for chaincode invocation
  # This user must be enrolled in Fabric network
  admin:
    username: "jumpserver-admin"
    org: "Org1MSP"
    msp_id: "Org1MSP"

    # Path to admin MSP directory (contains signcerts, keystore, etc.)
    # Generated by: fabric-ca-client enroll -u https://admin:password@fabric-ca:7054
    msp_path: "/etc/jumpserver/fabric-msp"

  # Timeout settings (milliseconds)
  timeouts:
    request: 30000
    query: 10000
    orderer: 30000

# =============================================================================
# HOW TO GET FABRIC CERTIFICATES:
# =============================================================================
#
# 1. Register JumpServer as Fabric client on Fabric CA server:
#
#    fabric-ca-client register \
#      --id.name jumpserver \
#      --id.type client \
#      --id.affiliation org1 \
#      -u https://admin:adminpw@fabric-ca:7054
#
# 2. Enroll to get certificates:
#
#    fabric-ca-client enroll \
#      -u https://jumpserver:password@fabric-ca:7054 \
#      --tls.certfiles /path/to/fabric-ca-cert.pem \
#      -M /etc/jumpserver/fabric-msp
#
#    This creates:
#      /etc/jumpserver/fabric-msp/signcerts/cert.pem  (client cert)
#      /etc/jumpserver/fabric-msp/keystore/...key.pem (private key)
#      /etc/jumpserver/fabric-msp/cacerts/ca-cert.pem (CA cert)
#
# 3. Copy certs to paths specified above:
#
#    cp /etc/jumpserver/fabric-msp/signcerts/cert.pem \
#       /etc/jumpserver/certs/fabric/client.pem
#
#    cp /etc/jumpserver/fabric-msp/keystore/*_sk \
#       /etc/jumpserver/certs/fabric/client-key.pem
#
#    cp /etc/jumpserver/fabric-msp/cacerts/ca-cert.pem \
#       /etc/jumpserver/certs/fabric/ca.pem
#
# 4. Set permissions:
#
#    chown jumpserver:jumpserver /etc/jumpserver/certs/fabric/*
#    chmod 600 /etc/jumpserver/certs/fabric/client-key.pem
#    chmod 644 /etc/jumpserver/certs/fabric/*.pem
#
# =============================================================================


# =============================================================================
# IPFS CONFIGURATION
# =============================================================================

ipfs:
  # IPFS HTTP API endpoint
  # For local node: /ip4/127.0.0.1/tcp/5001/http
  # For remote node: /dns/ipfs.example.com/tcp/5001/https
  api_url: "/ip4/127.0.0.1/tcp/5001/http"

  # mTLS Configuration (optional - if IPFS requires client cert)
  # Most IPFS deployments use HTTP, but you can enable mTLS for security
  mtls:
    enabled: false

    # Client certificate (if mTLS enabled)
    cert_file: "/etc/jumpserver/certs/ipfs/client.pem"
    key_file: "/etc/jumpserver/certs/ipfs/client-key.pem"

    # IPFS server CA certificate (to verify IPFS node)
    ca_cert_file: "/etc/jumpserver/certs/ipfs/ca.pem"

  # File encryption (AES-256-GCM)
  # Files are encrypted BEFORE upload to IPFS for confidentiality
  encryption:
    # Master encryption key (32 bytes, base64 encoded)
    # Generate with: openssl rand -base64 32
    # IMPORTANT: Store this securely! Loss means data is unrecoverable
    # Consider using HSM or key management service (AWS KMS, Azure Key Vault)
    master_key: "CHANGE_THIS_TO_GENERATED_KEY"

    # Algorithm (do not change)
    algorithm: "AES-256-GCM"

    # Key rotation (optional)
    # Automatically rotate encryption keys every N days
    rotation_days: 365

  # Pinning service (optional)
  # Ensures evidence files are never garbage collected
  pinning:
    enabled: true
    service: "pinata"  # Options: pinata, infura, filebase, or custom
    api_key: "YOUR_PINNING_SERVICE_API_KEY"

  # Timeout settings (seconds)
  timeouts:
    upload: 300  # 5 minutes for large files
    download: 300
    pin: 60

# =============================================================================
# HOW TO GENERATE ENCRYPTION KEY:
# =============================================================================
#
# openssl rand -base64 32
#
# Example output:
#   8G3x7vK2nQ9wY5pL4mR1tS6hJ0fC8dE2aB9zX3vN7yU=
#
# Copy this to encryption.master_key above.
#
# SECURITY NOTES:
#   - Never commit this file with real keys to git
#   - Use environment variables in production:
#       IPFS_ENCRYPTION_KEY=your-key-here
#   - Consider using dedicated key management:
#       - AWS KMS
#       - Azure Key Vault
#       - HashiCorp Vault
#       - Hardware Security Module (HSM)
#
# =============================================================================


# =============================================================================
# GUID RESOLVER CONFIGURATION
# =============================================================================

guid:
  # Enable anonymous evidence submission
  enabled: true

  # GUID format
  format: "uuid4"  # Options: uuid4, custom

  # Commitment scheme (for blockchain storage)
  # Stores hash(GUID:user_id:secret) on blockchain for verification
  commitment:
    enabled: true
    algorithm: "sha256"

  # Resolution audit
  # Log all GUID resolution attempts (Court role only)
  audit:
    enabled: true
    log_level: "WARNING"  # Resolution is sensitive, log prominently


# =============================================================================
# CERTIFICATE ROTATION CONFIGURATION
# =============================================================================

certificate_rotation:
  # Fabric client certificate renewal
  fabric:
    enabled: true
    # Renew N days before expiry (Fabric certs typically expire in 1 year)
    renew_days_before: 30
    # Auto-renewal via Celery (requires celery beat)
    auto_renew: true

  # IPFS client certificate renewal (if mTLS enabled)
  ipfs:
    enabled: false
    renew_days_before: 30
    auto_renew: false


# =============================================================================
# PERFORMANCE & CACHING
# =============================================================================

performance:
  # Cache blockchain queries (reduces Fabric load)
  cache:
    enabled: true
    ttl: 300  # seconds

  # Connection pooling
  connection_pool:
    enabled: true
    max_connections: 20
    timeout: 30

  # Batch operations
  batch:
    enabled: true
    max_batch_size: 100


# =============================================================================
# LOGGING
# =============================================================================

logging:
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR

  # Log blockchain transactions
  log_transactions: true

  # Log IPFS operations
  log_ipfs: true

  # Log certificate operations
  log_certificates: true
